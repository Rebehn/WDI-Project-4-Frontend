"use strict";function Auth(e,t){e.loginUrl=t+"/login",e.signupUrl=t+"/register",e.tokenPrefix=""}function ActionCable(e){e.debug=!0}function RegisterController(e,t){function r(){e.signup(o.user).then(function(){t.go("login")})}var o=this;o.user={},o.submit=r}function LoginController(e,t){function r(){e.login(o.credentials).then(function(){t.go("usersShow",{id:e.getPayload().id})})}var o=this;o.credentials={},o.submit=r}function Chatroom(e,t){return new e(t+"/chat_rooms/:id",{id:"@id"},{update:{method:"PUT"}})}function ChatroomsIndexController(e,t){function r(e){return!(e.private&&e.allowed_user_ids.indexOf(t.getPayload().id)<0)}var o=this;o.all=e.query(),o.hasAccess=r}function ChatroomsNewController(e,t,r){function o(){n.chatroom.allowed_user_ids=[r.getPayload().id],e.save(n.chatroom),t.go("chatrooms")}var n=this;n.chatroom={},n.submit=o}function ChatroomsShowController(e,t,r,o){function n(){d.chatroom.$update()}function l(e){return e.user_id===r.getPayload().id}function s(e){return e.id===d.currentUser.id}function a(e){d.chatroom.allowed_user_ids.push(e.id),n()}function i(e){return d.chatroom.allowed_user_ids.indexOf(e.id)<0}function u(e){return!(d.chatroom.allowed_user_ids.indexOf(e.id)<0||e.id===r.getPayload().id)}function c(e){var t=d.chatroom.allowed_user_ids.indexOf(e.id);d.chatroom.allowed_user_ids.splice(t,1),n()}var d=this;d.show=!1,d.chatroom=e.get(t.params),d.chatroom=e.get(t.params),d.update=n,d.isMyMessage=l,o.get({id:r.getPayload().id},function(e){d.currentUser=e,d.all=o.query()}),d.isSelf=s,d.filter={username:""},d.allowUser=a,d.showOnAllList=i,d.showOnInChatList=u,d.revokePrivilege=c}function MainController(e,t,r,o){function n(e,n,l){var i=t.getPayload();s.burgerOpen=!1,i&&(s.currentUser=o.get({id:i.id})),(!t.isAuthenticated()&&a.includes(n.name)||"usersEdit"===n.name&&parseFloat(l.id)!==t.getPayload().id)&&(e.preventDefault(),r.go("login"))}function l(){t.logout(),r.go("landing")}var s=this,a=["usersEdit","usersIndex","usersShow","chatroomsIndex","chatroomsNew","chatrooms"];s.logout=l,s.isLoggedIn=t.isAuthenticated,e.$on("$stateChangeStart",n)}function MessageController(e,t,r,o,n,l){function s(e){return e.user_id===n.getPayload().id}console.log("Message controller loaded");var a=this;a.inputText="",o.get({id:n.getPayload().id},function(e){a.currentUser=e}),a.isOwnMessage=s,a.myData=t.query({chat_room_id:l.params.id});var i=new e("ChatChannel",{user:a.currentUser,chat:l.params.id}),u=function(e){a.myData.push(e)};i.subscribe(u).then(function(){a.sendToMyChannel=function(e){var r={body:e,sender:a.currentUser.username,user_id:n.getPayload().id,chat_room_id:l.params.id};t.save(r),i.send(r)},r.$on("$destroy",function(){i.unsubscribe().then(function(){a.sendToMyChannel=void 0})})})}function Message(e,t){return new e(t+"/messages/:id",{id:"@id"},{update:{method:"PUT"}})}function Router(e,t){e.state("usersIndex",{url:"/users",templateUrl:"/templates/usersIndex.html",controller:"UsersIndexController as usersIndex"}).state("usersShow",{url:"/users/:id",templateUrl:"/templates/usersShow.html",controller:"UsersShowController as usersShow"}).state("usersEdit",{url:"/users/:id/edit",templateUrl:"/templates/usersEdit.html",controller:"UsersEditController as usersEdit"}).state("register",{url:"/register",templateUrl:"/templates/register.html",controller:"RegisterController as register"}).state("login",{url:"/login",templateUrl:"/templates/login.html",controller:"LoginController as login"}).state("landing",{url:"/",templateUrl:"/templates/landing.html"}).state("chatrooms",{url:"/chatrooms",templateUrl:"/templates/chatroomsIndex.html",controller:"ChatroomsIndexController as chatroomsIndex"}).state("chatroomsNew",{url:"/chatrooms/new",templateUrl:"/templates/chatroomsNew.html",controller:"ChatroomsNewController as chatroomsNew"}).state("chatroomsShow",{url:"/chatrooms/:id",templateUrl:"/templates/chatroomsShow.html",controller:"ChatroomsShowController as chatroomsShow"}),t.otherwise("/chatrooms")}function StatusController(e){this.status=e}function User(e,t){return new e(t+"/users/:id",{id:"@id"},{update:{method:"PUT"}})}function UsersIndexController(e,t){function r(e){return e.id===o.currentUser.id}var o=this;e.get({id:t.getPayload().id},function(t){o.currentUser=t,o.all=e.query()}),o.isSelf=r,o.filter={username:""}}function UsersShowController(e,t,r){function o(){var e=r.getPayload();return e&&e.id===Number(t.params.id)}function n(){l.user.$remove(function(){r.logout(),t.go("landing")})}var l=this;l.isCurrentUser=o,l.user=e.get(t.params),l.remove=n}function UsersEditController(e,t){function r(){o.user.$update(function(){t.go("usersShow",{id:o.user.id})})}var o=this;o.user=e.get(t.params),o.submit=r}angular.module("finalProject",["ngResource","ui.router","satellizer","ngActionCable"]).constant("API_URL","https://talkr-app-api.herokuapp.com/api").config(Auth).run(ActionCable),Auth.$inject=["$authProvider","API_URL"],ActionCable.$inject=["ActionCableConfig"],angular.module("finalProject").controller("RegisterController",RegisterController).controller("LoginController",LoginController),RegisterController.$inject=["$auth","$state"],LoginController.$inject=["$auth","$state"],angular.module("finalProject").factory("Chatroom",Chatroom),Chatroom.$inject=["$resource","API_URL"],angular.module("finalProject").controller("ChatroomsIndexController",ChatroomsIndexController).controller("ChatroomsNewController",ChatroomsNewController).controller("ChatroomsShowController",ChatroomsShowController),ChatroomsIndexController.$inject=["Chatroom","$auth"],ChatroomsNewController.$inject=["Chatroom","$state","$auth"],ChatroomsShowController.$inject=["Chatroom","$state","$auth","User"],angular.module("finalProject").controller("MainController",MainController),MainController.$inject=["$rootScope","$auth","$state","User"],angular.module("finalProject").controller("MessageController",MessageController),MessageController.$inject=["ActionCableChannel","Message","$scope","User","$auth","$state"],angular.module("finalProject").factory("Message",Message),Message.$inject=["$resource","API_URL"],angular.module("finalProject").config(Router),Router.$inject=["$stateProvider","$urlRouterProvider"],angular.module("finalProject").controller("StatusController",StatusController),StatusController.$inject=["ActionCableSocketWrangler"],angular.module("finalProject").factory("User",User),User.$inject=["$resource","API_URL"],angular.module("finalProject").controller("UsersIndexController",UsersIndexController).controller("UsersShowController",UsersShowController).controller("UsersEditController",UsersEditController),UsersIndexController.$inject=["User","$auth"],UsersShowController.$inject=["User","$state","$auth"],UsersEditController.$inject=["User","$state"];
//# sourceMappingURL=app.js.map
